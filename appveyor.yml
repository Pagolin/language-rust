# Clone location
clone_folder: c:\language-rust

# Add new environments to the build here:
environment:
  matrix:
    - resolver: lts-10 # ghc-8.2
    - resolver: lts-12 # ghc-8.4
    - resolver: nightly

# Manually fetch stack
install:
  - set PATH=C:\Program Files\Git\mingw64\bin;%PATH%
  - curl --output stack.zip --location --insecure http://www.stackage.org/stack/windows-x86_64
  - dir
  - 7z x stack.zip stack.exe
  - stack --no-terminal init --resolver %resolver% > nul
  - stack --no-terminal setup --resolver %resolver% > nul

# Install Happy and Alex first, before installing
build_script:
  - stack --no-terminal install --resolver %resolver% happy-1.19.8
  - stack --no-terminal install --resolver %resolver% alex

test_script:
  - stack --no-terminal test --resolver %resolver% :unit-tests --test-arguments "--plain"

